name: Güncel Verileri Çek ve Yayınla

on:
  schedule:
    # Her gün Türkiye saati ile yaklaşık 10:30 ve 18:30'da (07:30 ve 15:30 UTC) çalışır
    - cron: '30 7,15 * * *'
  workflow_dispatch: # İstediğin zaman GitHub paneli üzerinden manuel başlatabilmen için

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      - name: Depoyu Kontrol Et
        uses: actions/checkout@v4

      - name: Python Kurulumu
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Bağımlılıkları Yükle
        run: |
          python -m pip install --upgrade pip
          pip install evds python-dotenv pandas

      - name: Verileri Güncelle
        env:
          EVDS_API_KEY: ${{ secrets.EVDS_API_KEY }}
        run: python fetch_data.py

      - name: Değişiklikleri Commit Et ve Pushla
        run: |
          git config --local user.name 'github-actions[bot]'
          git config --local user.email 'github-actions[bot]@users.noreply.github.com'
          git add data.js
          # Eğer fiyatlar değişmemişse hata vermemesi için kontrol ekliyoruz
          git diff --quiet && git diff --staged --quiet || (git commit -m "Otomatik veri güncellemesi: $(date +'%d.%m.%Y %H:%M')" && git push)
